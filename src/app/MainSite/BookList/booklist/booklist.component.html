<div class="sign-in-area pt-50 pb-70">
  <br>
  <div class="container">
    <div class="alert alert-warning pull-left col-md-12"
      *ngIf="NewbookaddedbySuperAdmin.length && companyadmin">
      <p><strong>Note:</strong> We have noticed that there are some changes in the existing books by administrator. Would you like to accept those changes to reflect in your list?</p>
      <div class="row title2">
        <div class="col-lg-1"> <input type="checkbox" (change)="checkall($event.target.checked)" [checked]="selectAllCheckbox"></div>
        <div class="col-lg-4">Title</div>
        <div class="col-lg-2">Author</div>
        <div class="col-lg-3">Publisher</div>
        <div class="col-lg-2">Year</div>

      </div>
      <div class="row title3" *ngFor="let attan of NewbookaddedbySuperAdmin;let i=index"
        style="border-bottom: silver 1px solid;color: gray;">
        <div class="col-lg-1"><input type="checkbox" (change)="checkbook($event.target.checked,i)"
            [checked]="attan.IsSelected" [disabled]="attan.empId == companydetails.userId">
        </div>

        <div class="col-lg-4">{{attan.title}}</div>
        <div class="col-lg-2">{{attan.author}}</div>
        <div class="col-lg-3">{{attan.publisher}}</div>
        <div class="col-lg-2">{{attan.year}}</div>

      </div>
      <br>
      <div class="row">

        <div class="col-lg-12 col-md-12 " style="text-align: center;">
          <button type="submit" (click)="AddGlobalBookInList()" class="default-btn learn-btn-2">
            Accept
          </button>
        </div>


      </div>

      <p class="text-center mt-4">To assign these books to a Book List, please select books and click on Accept button.</p>
    </div>


    <h3>Book List</h3>


    <div class="row mb-3">
      <div [className]="searchBar_Width">
        <div class="row">
          <div class="col-sm-7" *ngIf="superadmin">
            <form class="form-inline">
              <label for="Company" class="mr-2">Company</label>
              <select id="mentorId" name="mentorId" class="form-control search-drop mr-2">
                <option disabled>Select Company</option>
                <option value="00000000-0000-0000-0000-000000000000">Global</option>
                <option *ngFor="let comp of companylist" value={{comp.id}}>
                  {{comp.companyname}}
                </option>
              </select>
              <button class="default-btn" (click)="searchbycompanyid()" mat-raised-button>
                Search
              </button>
            </form>
          </div>
          <!-- <div class="col-sm-2">
            <select class="form-control">
              <option> Select Track</option>
              <option *ngFor="let trac of trackCategory" [value]="trac.trackName">{{trac.trackName}}</option>
            </select>
          </div> -->
          <div [className]="search_width">
            <mat-form-field appearance="none" floatLabel="never" class="search-form-field form-control">
              <input matInput [(ngModel)]="searchKey" placeholder="Search" autocomplete="off" (keyup)="applyFilter()">
              <button (click)="cleartext()" *ngIf="searchKey" matSuffix mat-icon-button aria-label="Clear">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="col-sm-2 " style="text-align:right !important" *ngIf="!companyuser && !mentor">
        <button class="pull-right default-btn" (click)="addbook()" mat-raised-button>
          <mat-icon>add</mat-icon> Add New Book
        </button>
      </div>
    </div>


    <table class="tb-r" mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

      <ng-container matColumnDef="coverImageUrl">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Cover </th>
        <td mat-cell *matCellDef="let element"> <img src="{{element.coverImageUrl}}"
            style="width: 60px;height:80px;padding: 5px;" /> </td>
      </ng-container>
      <!-- Position Column -->
      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Author </th>
        <td mat-cell *matCellDef="let element"> {{element.author}} </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder; "> Title </th>
        <td mat-cell *matCellDef="let element"> {{ (element.title.length>40)? (element.title |
          slice:0:40)+'...':(element.title) }}</td>
      </ng-container>

      <ng-container matColumnDef="companyName" *ngIf="usertypeid!=undefined">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder; "> Company Name </th>
        <td mat-cell *matCellDef="let element"> {{element.companyName }} </td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="publisher">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Publisher </th>
        <td mat-cell *matCellDef="let element"> {{element.publisher}} </td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Year </th>
        <td mat-cell *matCellDef="let element"> {{element.year}} </td>
      </ng-container>

      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Rating </th>
        <td mat-cell *matCellDef="let element"> {{element.rating}} </td>
      </ng-container>
      <ng-container matColumnDef="averageRating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Global Rating </th>
        <td mat-cell *matCellDef="let element"> {{element.averageRating}} </td>
      </ng-container>

      <ng-container matColumnDef="trackCategory">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Track </th>
        <td mat-cell *matCellDef="let element"> {{element.trackCategory}} </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: bolder;"> Action </th>
        <td mat-cell *matCellDef="let element">
          <!-- <a mat-icon-button color="" (click)="MarkBookRead(element.id,element.companyID)">Read</a>  -->
          <!-- <a mat-icon-button color="" [routerLink]="['/library/edit-book',element.id]"><mat-icon>edit</mat-icon></a>  -->
          <span *ngIf="companyadmin || superadmin || (individual && element.companyID == '')">
            <button mat-icon-button color="primary" (click)="EditBook(element.id,element.companyID)">
              <mat-icon matTooltip="Edit">edit</mat-icon>
            </button>
          </span>
          <span *ngIf="companyadmin || superadmin || (individual && element.companyID == '')">
            <button mat-icon-button color="warn" (click)="DeleteBook(element.id,element.companyID)">
              <mat-icon matTooltip="Delete">delete_outline</mat-icon>
            </button>
          </span>

          <!-- *ngIf="!element.isBookRead" -->
          <button mat-icon-button  *ngIf="!superadmin"
            (click)="markbookasreadBtn(markbookasreadpopup,element.id,element.parentBookId)"
            [disabled]="element.isBookRead">
            <mat-icon matTooltip="Mark As Read">grading</mat-icon>
          </button>
          <!-- <span *ngIf="superadmin && companyid=='00000000-0000-0000-0000-000000000000' && element.quizID == 0"> |
          </span> -->
          <button mat-icon-button color="warn" *ngIf="superadmin && isGlobalBooks && element.quizID == 0"
            [routerLink]="['/Admin/addquiz']" [queryParams]="{id:element.id}">
            <mat-icon matTooltip="Add New Quiz">quiz</mat-icon>
          </button>

          <button mat-icon-button color="accent"
            *ngIf="companyadmin && element.quizID == 0 && element.parentBookId == ''|| (individual && element.companyID == '' && element.quizID == 0 && element.parentBookId == '')"
            (click)="addquizBtn(addquizpopup,element.id)">
            <mat-icon matTooltip="Add New Quiz">edit_note</mat-icon>
          </button>
          <!-- <a *ngIf="superadmin && companyid=='00000000-0000-0000-0000-000000000000' && element.quizID == 0" mat-button
            href="javascript:void()" [routerLink]="['/Admin/addquiz']" [queryParams]="{id:element.id}">Add Quiz</a> -->
          <button mat-icon-button color="warn" *ngIf="!superadmin && element.quizID > 0 && element.isQuizPublished"
            (click)="getQuizQuestionList(true, element.id)"
            [disabled]="(element.isBookRead && element.isQuizAttended) || !element.isBookRead">
            <mat-icon matTooltip="Attend Quiz">quiz</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr class="bg-y" mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
    <mat-paginator [pageSizeOptions]="[5,10,25,100]" [pageSize]="10" showFirstLastButtons></mat-paginator>
  </div>


</div>
<ng-template #markbookasreadpopup let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Mark As Read</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">Ã—</span>
    </button>
  </div>
  <form #markbookreadform="ngForm">
    <div class="modal-body">
      <div class="col-lg-12 col-md-12 ">
        <div class=" col-lg-12">
          <span style="color: gray;font-size:14px;">Rating (1 = Waste of Time; 10 = Excellent)</span>
          <div class="form-group">

            <select class="form-control" id="Rating" name="Rating" [(ngModel)]="BookReadModel.Rating" #Rating="ngModel"
              required>
              <option disabled>Select Rating </option>
              <option value=1>1</option>
              <option value=2>2</option>
              <option value=3>3</option>
              <option value=4>4</option>
              <option value=5>5</option>
              <option value=6>6</option>
              <option value=7>7</option>
              <option value=8>8</option>
              <option value=9>9</option>
              <option value=10>10</option>
            </select>
            <p *ngIf="btnclick==true && Rating.valid==false" style="color: red;font-size: 12px;">Rating is
              required!</p>
          </div>
        </div>
        <div class="col-lg-12">
          <span style="color: gray;font-size:14px;">Comments</span>
          <div class="form-group">
            <textarea [(ngModel)]="BookReadModel.Comments" #Comments="ngModel" id="Comments" name="Comments"
              maxlength="500" [required]="IsCheckbox" class="form-control" rows="6"></textarea>

          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="SaveMarkAsRead(markbookreadform,modal)">Save </button>
    </div>
  </form>
</ng-template>


<ng-template #template let-modal>

  <div class="col-12 col-offset-2" style="margin-top: -5%;">
    <div class="wizard-container">
      <mat-card class="wizard-card" *ngIf="!showQuiz">
        <mat-card-content>
          <div class="wizard-header">
            <h3 class="wizard-title">
              Thank you so much for rating the book
            </h3>
          </div>
          <div class="row" *ngIf="totalnoOFQues > 0">
            <div class="col-sm-12">
              <h6 style="margin: 30px 30px 20px 30px;">Next step is to answer the quiz questions to examine your
                understanding of the book. Would you like to proceed now?</h6>
            </div>
            <div class="col-sm-12">
              <div class="mt-3" style="text-align: right; margin-right: 30px;">
                <input type="button" class="btn btn-primary btn-sm btnmargin m-l-5" value="Yes, Proceed"
                  (click)="startQuiz()" />
                <input type="button" class="btn btn-primary btn-sm btnmargin" value="No, Take it later"
                  (click)="quizClosed()" />
              </div>
            </div>
          </div>
          <div class="row" *ngIf="totalnoOFQues == 0">
            <div class="col-sm-12">
              <h6 style="margin: 30px 30px 20px 30px;">You have earned the 10 credit. Please continue to read next book.
              </h6>
            </div>
            <div class="col-sm-12">
              <div class="mt-3" style="text-align: right; margin-right: 30px;">
                <input type="button" class="btn btn-primary btn-sm btnmargin m-l-5" value="OK" (click)="quizClosed()" />

              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      <mat-card class="wizard-card" *ngIf="showQuiz">
        <div *ngIf="instructionread">
          <mat-card-content>
            <div class="wizard-header">
              <h3 class="wizard-title">
                Quiz <span *ngIf="showPercentage"></span>
              </h3>
              <h5 *ngIf="!showPercentage">Please answer these questions about the Book.</h5>
            </div>
            <div class="tab-content m-30">
              <div *ngIf="!showPercentage">
                <div *ngFor="let o of lstquestion;let i =index">
                  <div *ngIf="active==o.questionid">
                    <!-- <div style="position:absolute;right: 40px; top: 88%;">
                    <input type="checkbox" [checked]="false" [value]="o.questionid" (change)="onCheckboxChange($event)" />
                    Click here to review later
                  </div> -->
                    <div class="row">
                      <h4 class="col-md-10" style="color: #5d6064;font-size: 16px;font-weight:500;">{{i+1}}).
                        {{o.question}}</h4>
                      <label class="col-md-2" style="font-weight: bold;font-size: 16px">{{i+1}} of
                        {{totalnoOFQues}}</label>
                    </div>

                    <div *ngIf="o.questiontype=='Subjective'" style="margin-bottom: 20px;">

                      <textarea type="text" name="queanswer" (keypress)="onKeypressEvent($event.target.value)"
                        [value]="queanswer" (change)="changeanswer($event.target.value,o.questionid)"
                        class="form-control m-b-5" rows="5" cols="5" [disabled]="o.useranswer != null"></textarea>
                    </div>
                    <div *ngIf="o.questiontype=='Multiple Choice Question' || o.questiontype=='Yes/No'">
                      <mat-radio-group aria-labelledby="example-radio-group-label" class="example-radio-group">
                        <mat-radio-button class="example-radio-button" [checked]="oo.options == queanswer"
                          *ngFor="let oo of o.questionoptions" [value]="oo.options" [disabled]="o.useranswer != null"
                          (change)="changeanswer($event.value,o.questionid)">
                          {{oo.options}}

                        </mat-radio-button>
                      </mat-radio-group>
                    </div>

                    <div class="row">
                      <div class="col-md-12" *ngIf="ShowQuestionResult">
                        <section class="messages">
                          <div *ngIf="o.useranswer == o.defaultans">
                            <p class="message correct-message text-success">
                              <mat-icon class="sentiment">sentiment_very_satisfied</mat-icon>
                              That&apos;s right! The correct answer is "{{ o.defaultans }}".
                            </p>
                          </div>
                          <div *ngIf="o.useranswer != o.defaultans">
                            <p class="message wrong-message text-danger">
                              <mat-icon class="sentiment">sentiment_very_dissatisfied</mat-icon>
                              That&apos;s wrong! The correct answer is "{{ o.defaultans }}".
                            </p>
                          </div>
                        </section>
                      </div>



                      <div class="col-sm-12 mt-30">

                        <div class="mt-3" style="text-align: right;">
                          <input type="button" [disabled]="prevbuttonDisabled" class="btn btn-primary btn-sm  btnmargin"
                            value="Previous" (click)="previous(o.questionid,i-1)" />
                          <input *ngIf="lstquestion[lstquestion.length-1].questionid>active" [disabled]="buttonDisabled"
                            type="button" class="btn btn-primary btn-sm btnmargin m-l-5  " value="Next"
                            (click)="next(o.questionid,i+1)" />
                          <span *ngIf="show">
                            <!-- <input *ngIf="lstquestion[lstquestion.length-1].questionid==active && skipque.length!=0" type="button" class="btn btn-primary btn-sm  m-l-5  " value="Review later" (click)="reviewlater()" /> -->
                            <input *ngIf="lstquestion[lstquestion.length-1].questionid==active && skipque.length==0"
                              type="button" class="btn btn-primary btn-sm btnmargin m-l-5  " value="Submit"
                              (click)="submit()" />
                          </span>
                        </div>

                        <!-- <div style="display: inline-block;"><input type="button" class="btn btn-primary btn-sm  m-l-5  " value="Save for later" (click)="saveforlater()" /></div> -->



                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngIf="showPercentage">
                <mat-card-content>
                  <div class="wizard-header">
                    <h3 class="wizard-title">
                      Thank you so much for attending the quiz
                    </h3>
                  </div>
                  <div class="row" >
                    <div class="col-sm-12">
                      <h6 style="margin: 30px 30px 20px 30px;">TOTAL SCORE {{correctAns}} OUT OF {{totalnoOFQues}} =
                        {{TotalPercentage}} %
                      </h6>
                      <h6 style="margin: 0px 30px 20px 30px;">You have earned {{((TotalPercentage * (10)) / 100)}} credit. 
                      </h6>
                    </div>
                    
                    <div class="col-sm-12">
                      <div class="mt-3" style="text-align: right; margin-right: 30px;">
                        <input type="button" class="btn btn-primary btn-sm  btnmargin" value="OK" (click)="quizClosed()" />
        
                      </div>
                    </div>
                  </div>
                </mat-card-content>
               
              </div>

            </div>
          </mat-card-content>
          <div style="padding:0px 30px;margin-bottom: 10px;" *ngIf="!showPercentage">
            <mat-card-content>
              <mat-progress-bar [value]="value" class="example-margin progress">
              </mat-progress-bar>
            </mat-card-content>

          </div>
        </div>
        <div *ngIf="!instructionread">
          <mat-card-content>
            <div class="wizard-header">
              <h3 class="wizard-title">
                Quiz Instruction
              </h3>
            </div>
            <div class="row" >
              <div class="col-sm-12">
                <div>
                  <h5 style="text-align: center; "><u>Guidelines for the Online Quiz</u></h5>
                  <div [innerHTML]="instructions"></div>
                </div>
              </div>
              <div class="col-sm-12">
                <div class="mt-3" style="text-align: right; margin-right: 30px;">
                  <input type="button" class="btn btn-primary btn-sm btnmargin m-l-5" value="Start Test" (click)="instructionhide()" />
  
                </div>
              </div>
            </div>
          </mat-card-content>
        </div>
      </mat-card>

    </div>
  </div>



</ng-template>

<ng-template #addquizpopup let-modal>
  <div class="modal-header">
    <!-- <h4 class="modal-title" id="modal-basic-title">Add Quiz</h4> -->
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">Ã—</span>
    </button>
  </div>

  <div class="modal-body">
    <div>
      <app-addquiz [bookId]="bookId" [from]="'booklist'"></app-addquiz>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.dismiss('Cross click')">Close </button>
  </div>

</ng-template>

<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="default" type="ball-spin-clockwise">
  <p style="color: white">Please Wait. </p>
</ngx-spinner>